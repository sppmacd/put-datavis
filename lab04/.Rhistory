arrange(., -sum_value)
services_annual_dataset %>%
group_by(Product) %>%
summarise(sum_value = sum(Value)) %>%
arrange(., -sum_value)
dplyr::glimpse(services_annual_dataset)
services_annual_dataset %>%
group_by(ValueFlagCode) %>%
summarise(sum_value = sum(Value)) %>%
arrange(., -sum_value)
services_annual_dataset %>%
group_by(ValueFlag) %>%
summarise(sum_value = sum(Value)) %>%
arrange(., -sum_value)
services_annual_dataset %>%
group_by(ValueFlag) %>%
summarise(sum_value = count(Value)) %>%
arrange(., -sum_value)
services_annual_dataset %>%
group_by(ValueFlag) %>%
summarise(count = count(Value)) %>%
arrange(., -count)
services_annual_dataset %>%
group_by(ValueFlag) %>%
count() %>%
arrange(., -count)
services_annual_dataset %>%
group_by(ValueFlag) %>%
count()
services_annual_dataset %>%
group_by(ValueFlag) %>%
count %>%
arrange(., -n)
dplyr::glimpse(services_annual_dataset)
services_annual_dataset %>%
group_by(IndicatorCode) %>%
count %>%
arrange(., -n)
dplyr::glimpse(merchandise_values_annual_dataset)
services_annual_dataset %>%
group_by(UnitCode) %>%
count %>%
arrange(., -n)
services_annual_dataset %>%
group_by(ReporterCode) %>%
count %>%
arrange(., -n)
services_annual_dataset %>%
group_by(Reporter) %>%
count %>%
arrange(., -n)
services_annual_dataset %>%
s_apply(function(x) n_distinct(x))
services_annual_dataset %>%
sapply(function(x) n_distinct(x))
services_annual_dataset %>% summarise(vmax = max(Value), vmin = min(Value))
services_annual_dataset %>% n_distinct(services_annual_dataset$Value)
len(services_annual_dataset)
length(services_annual_dataset)
length(services_annual_dataset%Value)
length(services_annual_dataset$Value)
services_annual_dataset %>%
apply(function(x) n_distinct(x))
services_annual_dataset %>%
sapply(function(x) n_distinct(x))
?sapply
services_annual_dataset %>% n_distinct(services_annual_dataset$Year)
services_annual_dataset$Value
sort(services_annual_dataset$Value)
services_annual_dataset %>% n_distinct(services_annual_dataset$Value)
n_distinct(services_annual_dataset$Value)
services_annual_dataset %>%
sapply(function(x) n_distinct(x))
dataset = concat(services_annual_dataset, merchandise_values_annual_dataset)
dataset = bind_rows(services_annual_dataset, merchandise_values_annual_dataset)
dataset
glimpse(dataset)
dataset %>%
sapply(function(x) n_distinct(x))
dataset %>% select(-one_of(c("Period", "PeriodCode", "FrequencyCode", "Frequency", "Unit", "UnitCode"))) -> dataset
dataset %>%
sapply(function(x) n_distinct(x))
services_annual_dataset %>%
group_by(Reporter) %>%
summarise(sum_value = sum(Value)) %>%
arrange(., -sum_value) %>%
head(10) ->
s_agg
ggplot(s_agg) + geom_bar(stat="identity", aes(x=ReporterCode, y=sum_value))
services_annual_dataset %>%
group_by(c(Partner, Reporter)) %>%
summarise(sum_value = sum(Value)) %>%
arrange(., -sum_value) %>%
head(10) ->
s_agg
services_annual_dataset %>%
group_by(Partner) %>%
summarise(sum_value = sum(Value)) %>%
arrange(., -sum_value) %>%
head(10) ->
s_agg
s_agg
services_annual_dataset %>%
group_by(Partner) %>%
summarise(sum_value = sum(Value)) %>%
arrange(., -sum_value) ->
s_agg
s_agg
services_annual_dataset %>%
group_by(Reporter) %>%
summarise(sum_value = sum(Value)) %>%
arrange(., -sum_value) ->
s_agg
s_agg
glimpse(dataset)
services_annual_dataset %>%
group_by(ProductClassification) %>%
summarise(sum_value = sum(Value)) %>%
arrange(., -sum_value) ->
s_agg
s_agg
dataset %>%
group_by(ProductClassification) %>%
summarise(sum_value = sum(Value)) %>%
arrange(., -sum_value) ->
s_agg
s_agg
dataset %>%
group_by(Product) %>%
summarise(sum_value = sum(Value)) %>%
arrange(., -sum_value) ->
s_agg
s_agg
dataset %>%
group_by(Reporter, Partner) %>%
summarise(sum_value = sum(Value)) %>%
arrange(., -sum_value) ->
s_agg
s_agg
glimpse(dataset)
dataset %>%
group_by(Reporter, Partner, PartnerISO3A) %>%
summarise(sum_value = sum(Value)) %>%
arrange(., -sum_value) ->
s_agg
s_agg
dataset %>%
group_by(PartnerISO3A) %>%
summarise(sum_value = sum(Value)) %>%
arrange(., -sum_value) ->
s_agg
s_agg
s_agg
dataset %>%
group_by(Partner) %>%
summarise(sum_value = sum(Value)) %>%
arrange(., -sum_value) ->
s_agg
s_agg
dataset %>%
group_by(Partner) %>%
summarise(sum_value = sum(Value)) %>%
arrange(., -sum_value) ->
s_agg
s_agg
dataset %>%
group_by(Partner) %>%
summarise(sum_value = sum(Value)) %>%
arrange(., -sum_value) ->
s_agg
glimpse(dataset)
dataset %>%
sapply(function(x) n_distinct(x))
dataset %>%
group_by(Product) %>%
summarise(sum_value = sum(Value)) %>%
arrange(., -sum_value) ->
s_agg
s_agg
dataset %>%
group_by(Product) %>%
summarise(sum_value = sum(Value)) %>%
arrange(., -sum_value)
dataset %>%
group_by(Product, Reporter) %>%
summarise(sum_value = sum(Value)) %>%
arrange(., -sum_value)
dataset %>%
group_by(Product, Reporter) %>%
summarise(sum_value = sum(Value)) %>%
arrange(., -sum_value) -> s_agg
print(s_agg, n=100)
glimpse(dataset)
dataset %>%
group_by(ProductClassification, Reporter) %>%
summarise(sum_value = sum(Value)) %>%
arrange(., -sum_value) -> s_agg
print(s_agg, n=100)
dataset %>%
group_by(ValueFlag, Reporter) %>%
summarise(sum_value = sum(Value)) %>%
arrange(., -sum_value) -> s_agg
print(s_agg, n=100)
dataset %>%
group_by(Year, Reporter) %>%
summarise(sum_value = sum(Value)) %>%
arrange(., -sum_value) -> s_agg
print(s_agg, n=100)
dataset %>%
group_by(Year, Reporter) %>%
slice_max(order_by = Reporter, n = 5) %>%
summarise(sum_value = sum(Value)) %>%
arrange(., -sum_value) -> s_agg
print(s_agg, n=100)
dataset %>%
group_by(Year, Reporter) %>%
slice_max(order_by = Reporter, n = 5) %>%
summarise(sum_value = sum(Value))
print(s_agg, n=100)
dataset %>%
group_by(Year) %>%
slice_max(order_by = Reporter, n = 5) %>%
summarise(sum_value = sum(Value))
dataset %>%
group_by(Reporter, Year) %>%
summarise(sum_value = sum(Value))
print(s_agg, n=100)
dataset %>%
group_by(Reporter, Year) %>%
summarise(sum_value = sum(Value)) %>%
slice_max(order_by = Reporter, n = 5)
print(s_agg, n=100)
dataset %>%
group_by(Reporter, Year) %>%
summarise(sum_value = sum(Value)) %>%
group_by(Year) %>%
slice_max(order_by = Reporter, n = 5)
dataset %>%
group_by(Reporter, Year) %>%
summarise(sum_value = sum(Value)) %>%
group_by(Year) %>%
slice_max(order_by = sum_value, n = 5)
top_reporters = dataset %>%
group_by(Reporter) %>%
summarise(sum_value = sum(Value)) %>%
arrange(.-sum_value)
top_reporters = dataset %>%
group_by(Reporter) %>%
summarise(sum_value = sum(Value)) %>%
arrange(-sum_value)
top_reporters
top_reporters = dataset %>%
group_by(Reporter) %>%
summarise(sum_value = sum(Value)) %>%
arrange(-sum_value) %>%
head(10)
top_reporters = top_reporters$Reporter
top_reporters
top_reporters = dataset %>%
group_by(ReporterCode) %>%
summarise(sum_value = sum(Value)) %>%
arrange(-sum_value) %>%
head(10)
top_reporters = top_reporters$ReporterCode
top_reporters
dataset %>%
group_by(ReporterCode, Reporter, Year) %>%
summarise(sum_value = sum(Value)) %>%
filter(ReporterCode %in% top_reporters)
print(s_agg, n=100)
top_reporters
dataset %>%
group_by(ReporterCode, Reporter, Year) %>%
summarise(sum_value = sum(Value)) %>%
filter(ReporterCode %in% top_reporters)
dataset %>%
group_by(ReporterCode, Reporter, Year) %>%
summarise(sum_value = sum(Value)) %>%
filter(ReporterCode %in% top_reporters) -> s_agg
print(s_agg, n=100)
ggplot(s_agg) + geom_line(aes(color=Reporter, x=Year, y=sum_value))
ggplot(s_agg) + geom_line(aes(color=ReporterCode, x=Year, y=sum_value))
dataset
top_reporters = dataset %>%
group_by(ReporterCode) %>%
summarise(sum_value = sum(Value)) %>%
arrange(-ReporterCode)
top_reporters = dataset %>%
group_by(ReporterCode) %>%
summarise(sum_value = sum(Value)) %>%
arrange(ReporterCode)
top_reporters
top_reporters = dataset %>%
group_by(ReporterCode, Reporter) %>%
summarise(sum_value = sum(Value)) %>%
arrange(ReporterCode)
top_reporters
print(top_reporters, n=300)
top_reporters = dataset %>%
group_by(PartnerCode, Partner) %>%
summarise(sum_value = sum(Value)) %>%
arrange(PartnerCode)
print(top_reporters, n=300)
?as.numeric
reporter_is_bullshit = function(rc) {
if (rc == "000") { return(T) }
if (!is.numeric(rc)) { return(T) }
rc = as.numeric(rc)
return(rc < 900)
}
dataset %>% filter(reporter_is_bullshit(ReporterCode)) -> dataset
reporter_is_bullshit = function(rc) {
print(rc)
if (rc == "000") { return(T) }
if (!is.numeric(rc)) { return(T) }
rc = as.numeric(rc)
return(rc < 900)
}
dataset %>% filter(reporter_is_bullshit(ReporterCode)) -> dataset
reporter_is_bullshit = function(rc) {
if (rc = "000") { return(T) }
dataset %>% filter(reporter_is_bullshit(ReporterCode)) -> dataset
reporter_is_bullshit = function(rc) {
if (rc == "000") { return(T) }
if (!is.numeric(rc)) { return(T) }
rc = as.numeric(rc)
return(rc < 900)
}
dataset %>% filter(reporter_is_bullshit(ReporterCode)) -> dataset
reporter_is_bullshit = function(rc) {
if_else(
rc == "000",
TRUE,
if_else(
!is.numeric(rc),
TRUE,
as.numeric(rc) < 900
)
)
}
dataset %>% filter(reporter_is_bullshit(ReporterCode)) -> dataset
dataset
# some basic info about data
dataset %>%
sapply(function(x) n_distinct(x))
glimpse(dataset)
top_reporters = dataset %>%
group_by(PartnerCode, Partner) %>%
summarise(sum_value = sum(Value)) %>%
arrange(PartnerCode)
print(top_reporters, n=300)
dataset %>% filter(reporter_is_bullshit(ReporterCode)) -> dataset
# concat these tables
dataset = bind_rows(services_annual_dataset, merchandise_values_annual_dataset)
# drop useless columns (having only a single value)
dataset %>% select(-one_of(c("Period", "PeriodCode", "FrequencyCode", "Frequency", "Unit", "UnitCode"))) -> dataset
# - The rest are countries
reporter_is_bullshit = function(rc) {
if_else(
rc == "000",
TRUE,
if_else(
!is.numeric(rc),
TRUE,
as.numeric(rc) < 900
)
)
}
glimpse(dataset)
dataset %>% filter(reporter_is_bullshit(ReporterCode)) -> dataset
glimpse(dataset)
reporter_is_bullshit = function(rc) {
if_else(
rc == "000",
TRUE,
if_else(
!is.numeric(rc),
TRUE,
as.numeric(rc) >= 900
)
)
}
dataset %>% filter(!reporter_is_bullshit(ReporterCode)) -> dataset
dataset %>% filter(~reporter_is_bullshit(ReporterCode)) -> dataset
dataset %>% filter(-reporter_is_bullshit(ReporterCode)) -> dataset
reporter_is_bullshit = function(rc) {
if_else(
rc == "000",
TRUE,
if_else(
-is.numeric(rc),
TRUE,
as.numeric(rc) >= 900
)
)
}
dataset %>% filter(-reporter_is_bullshit(ReporterCode)) -> dataset
reporter_is_bullshit = function(rc) {
if_else(
rc == "000",
TRUE,
if_else(
~is.numeric(rc),
TRUE,
as.numeric(rc) >= 900
)
)
}
dataset %>% filter(-reporter_is_bullshit(ReporterCode)) -> dataset
reporter_is_bullshit = function(rc) {
if_else(
rc == "000",
TRUE,
if_else(
!is.numeric(rc),
TRUE,
as.numeric(rc) >= 900
)
)
}
dataset %>% filter(-reporter_is_bullshit(ReporterCode)) -> dataset
rlang::last_trace()
reporter_is_ok = function(rc) {
if_else(
rc == "000",
FALSE,
if_else(
!is.numeric(rc),
FALSE,
as.numeric(rc) <= 900
)
)
}
dataset %>% filter(reporter_is_ok(ReporterCode)) -> dataset
reporter_is_ok = function(rc) {
# if_else(
# rc == "000",
#FALSE,
if_else(
!is.numeric(rc),
FALSE,
as.numeric(rc) <= 900
)
#)
}
dataset %>% filter(reporter_is_ok(ReporterCode)) -> dataset
reporter_is_ok = function(rc) {
if_else(
rc == "000",
FALSE,
if_else(
!is.numeric(rc),
FALSE,
as.numeric(rc) <= 900
)
)
}
reporter_is_ok = function(rc) {
if_else(
rc == "000",
FALSE,
if_else(
!is.numeric(as.numeric(rc)),
FALSE,
as.numeric(rc) <= 900
)
)
}
dataset %>% filter(reporter_is_ok(ReporterCode)) -> dataset
reporter_is_ok = function(rc) {
if_else(
rc == "000",
FALSE,
if_else(
!is.numeric(as.numeric(rc)),
FALSE,
as.numeric(rc) <= 900
)
)
}
dataset %>% filter(reporter_is_ok(ReporterCode)) -> dataset
reporter_is_ok = function(rc) {
if_else(
rc == "000",
FALSE,
TRUE
)
}
dataset %>% filter(reporter_is_ok(ReporterCode)) -> dataset
reporter_is_000 = dataset$ReporterCode == "000"
reporter_is_9xx = as.numeric(dataset$ReporterCode) > 900
reporter_is_nnum = !is.numeric(dataset$ReporterCode)
reporter_is_nnum
reporter_is_9xx
reporter_is_000 = dataset$ReporterCode == "000"
reporter_is_9xx = as.numeric(dataset$ReporterCode) > 900
reporter_is_nnum = as.numeric(dataset$ReporterCode)
reporter_is_9xx
reporter_is_nnum
reporter_is_nnum = as.numeric(dataset$ReporterCode) == NA
reporter_is_nnum
reporter_is_nnum = is.na(as.numeric(dataset$ReporterCode))
reporter_is_nnum
reporter_is_000 = dataset$ReporterCode == "000"
reporter_is_9xx = is.na(as.numeric(dataset$ReporterCode) > 900)
reporter_is_nnum = is.na(as.numeric(dataset$ReporterCode))
reporter_is_nnum
install.packages("scales")
source("~/.active-rstudio-document", echo = TRUE)
setwd("/home/sppmacd/Documents/szkola/_2024_2025_S/dv/put-datavis/lab04")
shiny::runApp('~/Documents/szkola/_2024_2025_S/dv/shiny/test')
print(1)
